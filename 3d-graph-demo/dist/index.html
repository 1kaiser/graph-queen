<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Graph Queen</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üëë</text></svg>">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #FFFFFF;
      color: #333;
      overflow: hidden;
      height: 100vh;
    }

    #container {
      width: 100%;
      height: 100%;
      position: relative;
      border: 2px solid #333;
    }

    /* Graph area with modern background */
    #graphArea {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #F8FAFC;
    }

    #graphArea svg {
      width: 100%;
      height: 100%;
    }

    /* Connect mode button */
    .mode-toggle {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 20;
      background: #FFFFFF;
      border: 2px solid #333;
      border-radius: 8px;
      padding: 10px 20px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
    }

    .mode-toggle.active {
      background: #4CAF50;
      color: white;
    }

    .mode-toggle:hover {
      background: #E0E0E0;
    }

    .mode-toggle.active:hover {
      background: #45A049;
    }

    /* Graph label */
    .graph-label {
      position: absolute;
      top: 120px;
      left: 50%;
      transform: translateX(-50%);
      background: #B8D4E8;
      padding: 15px 40px;
      border: 2px solid #333;
      border-radius: 8px;
      font-size: 20px;
      font-weight: bold;
      z-index: 5;
      pointer-events: none;
    }

    /* Draggable panels */
    .draggable-panel {
      position: absolute;
      background: #B8D4E8;
      border: 2px solid #333;
      border-radius: 8px;
      padding: 20px;
      cursor: move;
      user-select: none;
      z-index: 10;
    }

    .draggable-panel.dragging {
      opacity: 0.8;
    }

    /* Corner handle */
    .drag-handle {
      position: absolute;
      top: -8px;
      right: -8px;
      width: 24px;
      height: 24px;
      background: #B8D4E8;
      border: 2px solid #333;
      border-radius: 3px;
      cursor: nwse-resize;
    }

    /* Slide-in button panel */
    #slidePanel {
      top: 100px;
      right: 50px;
      width: 250px;
      text-align: center;
    }

    #slidePanel .panel-title {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    #slidePanel a {
      color: #0066CC;
      text-decoration: underline;
      font-size: 12px;
      word-break: break-all;
    }

    /* Upload button panel */
    #uploadPanel {
      top: 380px;
      right: 50px;
      width: 200px;
      text-align: center;
    }

    #uploadPanel .panel-title {
      font-size: 16px;
      font-weight: bold;
    }

    /* Text box at bottom with voice input */
    #textBoxContainer {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    #textBox {
      width: 520px;
      padding: 12px 20px;
      border: 2px solid #333;
      border-radius: 4px;
      background: #B8D4E8;
      font-size: 14px;
      font-family: inherit;
    }

    #textBox::placeholder {
      color: #666;
    }

    #voiceBtn {
      width: 50px;
      height: 50px;
      border: 2px solid #333;
      border-radius: 50%;
      background: #6366F1;
      color: white;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    #voiceBtn:hover {
      background: #4F46E5;
      transform: scale(1.05);
    }

    #voiceBtn.listening {
      background: #EF4444;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
      }
      50% {
        box-shadow: 0 0 0 15px rgba(239, 68, 68, 0);
      }
    }

    /* Upload input (hidden) */
    #fileInput {
      display: none;
    }

    /* Clickable upload panel */
    #uploadPanel {
      cursor: pointer;
    }

    #uploadPanel:hover {
      background: #A0C4DD;
    }

    /* Slide-in OCR Panel */
    #ocrSlidePanel {
      position: fixed;
      top: 0;
      right: -450px;
      width: 420px;
      height: 100vh;
      background: #FFFFFF;
      border-left: 3px solid #333;
      box-shadow: -5px 0 15px rgba(0,0,0,0.2);
      transition: right 0.3s ease-in-out;
      z-index: 100;
      padding: 30px;
      overflow-y: auto;
    }

    #ocrSlidePanel.open {
      right: 0;
    }

    #ocrSlidePanel .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 30px;
      height: 30px;
      border: 2px solid #333;
      background: #FF6B6B;
      border-radius: 4px;
      cursor: pointer;
      font-size: 20px;
      line-height: 26px;
      text-align: center;
      font-weight: bold;
    }

    #ocrSlidePanel .close-btn:hover {
      background: #FF5252;
    }

    #ocrSlidePanel h2 {
      margin-bottom: 20px;
      color: #1976D2;
    }

    .ocr-section {
      margin-bottom: 25px;
      padding: 15px;
      background: #F5F5F5;
      border: 2px solid #333;
      border-radius: 8px;
    }

    .ocr-section h3 {
      margin-bottom: 10px;
      font-size: 16px;
      color: #333;
    }

    .ocr-btn {
      width: 100%;
      padding: 12px;
      background: #1976D2;
      color: white;
      border: 2px solid #333;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      margin-top: 10px;
    }

    .ocr-btn:hover {
      background: #1565C0;
    }

    #ocrImageInput {
      display: none;
    }

    #ocrPreview {
      width: 100%;
      max-height: 200px;
      margin-top: 10px;
      border: 2px solid #333;
      border-radius: 4px;
      display: none;
    }

    #ocrResult {
      width: 100%;
      min-height: 150px;
      padding: 10px;
      border: 2px solid #333;
      border-radius: 4px;
      background: #FFFFFF;
      font-family: monospace;
      font-size: 13px;
      margin-top: 10px;
      resize: vertical;
    }

    #ocrStatus {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
      font-size: 13px;
      display: none;
    }

    #ocrStatus.loading {
      background: #FFF9C4;
      border: 2px solid #F57F17;
      display: block;
    }

    #ocrStatus.success {
      background: #C8E6C9;
      border: 2px solid #388E3C;
      display: block;
    }

    #ocrStatus.error {
      background: #FFCDD2;
      border: 2px solid #D32F2F;
      display: block;
    }

    /* Top toggle buttons - wordy style */
    .top-toggle-buttons {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      display: flex;
      gap: 10px;
    }

    .top-toggle-btn {
      padding: 12px 24px;
      background: #1976D2;
      color: white;
      border: 2px solid #333;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    .top-toggle-btn:hover {
      background: #1565C0;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .top-toggle-btn.active {
      background: #4CAF50;
    }

    /* Slide containers - wordy style */
    .slide-container {
      position: fixed;
      top: 0;
      right: 0;
      width: 100%;
      height: 100%;
      background: #FFFFFF;
      z-index: 9998;
      overflow-y: auto;
      transform: translateX(100%);
      transition: transform 0.5s ease;
      padding: 80px 40px 40px 40px;
      box-sizing: border-box;
    }

    .slide-container.visible {
      transform: translateX(0);
    }

    .slide-close-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      background: #FF6B6B;
      border: 3px solid #333;
      border-radius: 50%;
      cursor: pointer;
      font-size: 28px;
      line-height: 44px;
      text-align: center;
      font-weight: bold;
      color: #333;
      z-index: 9999;
      transition: all 0.3s ease;
    }

    .slide-close-btn:hover {
      background: #FF5252;
      transform: rotate(90deg);
    }

    .slide-content {
      max-width: 1200px;
      margin: 0 auto;
    }

    .slide-content h1 {
      color: #1976D2;
      margin-bottom: 30px;
      font-size: 36px;
    }

    .slide-content h2 {
      color: #333;
      margin-top: 30px;
      margin-bottom: 15px;
      font-size: 24px;
    }

    .slide-content p, .slide-content ul {
      font-size: 16px;
      line-height: 1.6;
      color: #555;
      margin-bottom: 15px;
    }

    .slide-content ul {
      list-style-type: disc;
      margin-left: 30px;
    }

    .slide-content code {
      background: #F5F5F5;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
      font-size: 14px;
    }
  </style>
  <script type="module" crossorigin src="/graph-queen/assets/index-DKwBQVWo.js"></script>
</head>
<body>
  <!-- Top toggle buttons -->
  <div class="top-toggle-buttons">
    <button class="top-toggle-btn" onclick="toggleOCRPanel()">üì∏ OCR</button>
    <button class="top-toggle-btn" onclick="toggleHelpPanel()">‚ùì Help</button>
    <button class="top-toggle-btn" onclick="toggleSettingsPanel()">‚öôÔ∏è Settings</button>
  </div>

  <div id="container">
    <!-- Graph visualization area -->
    <div id="graphArea">
      <!-- D3.js SVG will be inserted here -->
    </div>

    <!-- Image/PDF Upload Button (automatic OCR) -->
    <button class="mode-toggle" id="imageUploadBtn" onclick="document.getElementById('autoOCRInput').click()">
      üì∏ Upload Image/PDF
    </button>
    <input type="file" id="autoOCRInput" accept="image/*,application/pdf,.pdf" style="display: none;">

    <!-- Connect mode toggle -->
    <button class="mode-toggle" id="connectModeBtn" style="top: 60px;">
      üîó Connect Mode: OFF
    </button>

    <!-- Auto-connect button -->
    <button class="mode-toggle" id="autoConnectBtn" style="top: 110px;">
      ü§ñ Auto-Connect Similar
    </button>

    <!-- Export button -->
    <button class="mode-toggle" id="exportBtn" style="top: 160px;" onclick="exportGraphData()">
      üíæ Export Graph
    </button>

    <!-- Fit to Screen button -->
    <button class="mode-toggle" id="fitBtn" style="top: 210px;" onclick="fitToScreen()">
      üîç Fit to Screen
    </button>

    <!-- Clear Image button -->
    <button class="mode-toggle" id="clearImageBtn" style="top: 260px;" onclick="clearImageBackground()">
      üóëÔ∏è Clear Image
    </button>

    <!-- OCR Progress Indicator -->
    <div id="ocrProgress" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255,255,255,0.95); border: 3px solid #333; border-radius: 12px; padding: 30px 50px; z-index: 1000; text-align: center; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
      <div style="font-size: 48px; margin-bottom: 15px;">‚è≥</div>
      <div id="ocrProgressText" style="font-size: 18px; font-weight: bold; color: #333;">Processing image...</div>
      <div id="ocrProgressPercent" style="font-size: 14px; color: #666; margin-top: 8px;">0%</div>
    </div>

    <!-- Graph label -->
    <div class="graph-label">GRAPH</div>


    <!-- Upload button panel -->
    <div id="uploadPanel" class="draggable-panel" onclick="document.getElementById('fileInput').click()">
      <div class="drag-handle"></div>
      <div class="panel-title">
        UPLOAD<br>BUTTON
      </div>
    </div>
    <input type="file" id="fileInput" accept=".json,.mmd,.txt">

    <!-- Text box at bottom with voice input -->
    <div id="textBoxContainer">
      <input type="text" id="textBox" placeholder="Type or speak text, then press Enter (connects to selected nodes)">
      <button id="voiceBtn" title="Click to speak">üé§</button>
    </div>
  </div>

  <!-- OCR Slide Panel - Wordy Style -->
  <div id="ocr-slide-panel" class="slide-container">
    <div class="slide-close-btn" onclick="closeAllPanels()">√ó</div>
    <div class="slide-content">
      <h1>üì∏ OCR - Extract Text from Images</h1>

      <div class="ocr-section">
        <h2>1. Upload Image</h2>
        <button class="ocr-btn" onclick="document.getElementById('ocrImageInput').click()">
          Choose Image File
        </button>
        <input type="file" id="ocrImageInput" accept="image/*">
        <img id="ocrPreview" alt="Preview">
      </div>

      <div class="ocr-section">
        <h2>2. Extract Text</h2>
        <button class="ocr-btn" id="extractBtn" disabled>
          üîç Run OCR
        </button>
        <div id="ocrStatus"></div>
      </div>

      <div class="ocr-section">
        <h2>3. Extracted Text</h2>
        <textarea id="ocrResult" placeholder="Extracted text will appear here..." readonly></textarea>
        <button class="ocr-btn" id="useTextBtn" disabled>
          üëÅÔ∏è Visualize Word Rectangles
        </button>
      </div>

      <div class="ocr-section">
        <h2>4. Create Graph</h2>
        <p style="font-size: 14px; color: #666;">After visualization, select specific words by clicking their rectangles (they turn blue), or create graph from all words.</p>
        <button class="ocr-btn" id="createGraphSelectedBtn" onclick="createGraphFromWords(true)" disabled>
          ‚ûï Create Graph from Selected
        </button>
        <button class="ocr-btn" id="createGraphBtn" onclick="createGraphFromWords(false)" disabled>
          ‚ûï Create Graph from All
        </button>
      </div>
    </div>
  </div>

  <!-- Help Slide Panel - Wordy Style -->
  <div id="help-slide-panel" class="slide-container">
    <div class="slide-close-btn" onclick="closeAllPanels()">√ó</div>
    <div class="slide-content">
      <h1>‚ùì Graph Queen - Help & Documentation</h1>

      <h2>üéØ Features</h2>
      <ul>
        <li><strong>Molecular-style Graph:</strong> Hover over nodes to see connections highlighted</li>
        <li><strong>Node Creation:</strong> Type in text box and press Enter to create nodes</li>
        <li><strong>Connect to Selected:</strong> Select nodes first, then create a new node to auto-connect</li>
        <li><strong>Manual Connections:</strong> Toggle Connect Mode and click two nodes to create edges</li>
        <li><strong>AI Auto-Connect:</strong> Automatically connect similar nodes using text similarity</li>
        <li><strong>OCR Word Rectangles:</strong> Upload images to extract and position word nodes</li>
      </ul>

      <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
      <ul>
        <li><code>Ctrl+S</code> - Save graph to JSON file</li>
        <li><code>Ctrl+Z</code> - Undo last action</li>
        <li><code>Ctrl+Shift+Z</code> - Redo action</li>
        <li><code>Delete</code> or <code>Backspace</code> - Delete selected nodes/edges</li>
        <li><code>Ctrl+Click</code> - Multi-select nodes or edges</li>
      </ul>

      <h2>üñ±Ô∏è Mouse Controls</h2>
      <ul>
        <li><strong>Click node:</strong> Select/deselect node</li>
        <li><strong>Double-click node:</strong> Edit node label</li>
        <li><strong>Click edge:</strong> Select/deselect edge (turns red when selected)</li>
        <li><strong>Drag node:</strong> Reposition node in graph</li>
        <li><strong>Hover node:</strong> Show label and highlight connections</li>
        <li><strong>Ctrl+Click:</strong> Add to multi-selection (nodes or edges)</li>
      </ul>

      <h2>üìä ScribeOCR-Style Workflow (NEW!)</h2>
      <p style="background: #E0E7FF; padding: 10px; border-left: 4px solid #6366F1; margin-bottom: 15px;">
        <strong>üé® Enhanced Image + Word Box Visualization</strong><br>
        Image and word boxes now zoom/pan with your graph! Click individual word boxes to create nodes.
      </p>
      <p><strong>1. Upload Image:</strong> Click "üì∏ OCR" ‚Üí Choose Image File</p>
      <p><strong>2. Extract Text:</strong> Click "üîç Run OCR" and wait for completion</p>
      <p><strong>3. Visualize Words:</strong> Click "üëÅÔ∏è Visualize Word Rectangles"</p>
      <p style="margin-left: 20px;">‚ú® Image appears as background layer<br>‚ú® Word boxes overlay on top (hover turns blue)<br>‚ú® Everything zooms/pans together!</p>
      <p><strong>4. Create Nodes:</strong> Two options:</p>
      <p style="margin-left: 20px;">‚Ä¢ <strong>Click individual word boxes</strong> ‚Üí Creates node immediately<br>‚Ä¢ <strong>"Create Graph from All"</strong> ‚Üí Converts all remaining boxes to nodes</p>
      <p><strong>5. Keep Background:</strong> Image stays visible while you work!</p>
      <p><strong>6. Clear Image:</strong> Click "üóëÔ∏è Clear Image" button when done</p>
      <p><strong>7. Connect & Export:</strong> Use Connect Mode, Auto-Connect, then Export</p>

      <h2>üìä Manual Graph Building</h2>
      <p>1. Click a few nodes to select them (they turn blue)</p>
      <p>2. Type "Central Hub" in the text box at bottom</p>
      <p>3. Press Enter - a new node will be created connected to all selected nodes!</p>
      <p>4. Use "Auto-Connect Similar" to automatically link related words</p>
      <p>5. Save your work with Ctrl+S or Export button</p>
    </div>
  </div>

  <!-- Settings Slide Panel - Wordy Style -->
  <div id="settings-slide-panel" class="slide-container">
    <div class="slide-close-btn" onclick="closeAllPanels()">√ó</div>
    <div class="slide-content">
      <h1>‚öôÔ∏è Settings & Configuration</h1>

      <h2>üé® Graph Appearance</h2>
      <p>The graph uses a molecular-style visualization with:</p>
      <ul>
        <li>White circular nodes with black borders</li>
        <li>Steelblue selection color</li>
        <li>Light gray edges with subtle transparency</li>
        <li>Force-directed layout for automatic positioning</li>
      </ul>

      <h2>üîß Force Simulation Parameters</h2>
      <ul>
        <li><strong>Link Distance:</strong> 150px between connected nodes</li>
        <li><strong>Charge Strength:</strong> -300 (node repulsion)</li>
        <li><strong>Collision Radius:</strong> 40px (prevents overlap)</li>
      </ul>

      <h2>ü§ñ AI Similarity Settings</h2>
      <p>The auto-connect feature uses two algorithms:</p>
      <ul>
        <li><strong>Levenshtein Distance:</strong> Measures edit distance between words</li>
        <li><strong>Cosine Similarity:</strong> Uses character bigrams for comparison</li>
        <li><strong>Default Threshold:</strong> 60% similarity required</li>
        <li><strong>Custom Threshold:</strong> Adjustable when running auto-connect</li>
      </ul>

      <h2>üíæ Data Management</h2>
      <ul>
        <li><strong>Undo History:</strong> 50 states stored</li>
        <li><strong>Export Format:</strong> JSON with metadata</li>
        <li><strong>File Naming:</strong> graph_YYYY-MM-DD_HH-mm-ss.json</li>
      </ul>

      <h2>üîç OCR Settings</h2>
      <ul>
        <li><strong>Engine:</strong> Tesseract.js (browser-based)</li>
        <li><strong>Language:</strong> English (eng)</li>
        <li><strong>Output:</strong> Word bounding boxes with coordinates</li>
        <li><strong>PDF Support:</strong> First page extraction via PDF.js</li>
      </ul>

      <h2>üé® Basil.js Text Graph Demo</h2>
      <p style="margin-bottom: 15px;">
        Classic basil.js example: "Connecting All Words With Lines" - Type text in the boxes below and watch as every word from the left connects to every word on the right, creating an intricate network visualization!
      </p>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
        <div>
          <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #4F46E5;">Left Text Block:</label>
          <textarea id="basilText1" rows="4" style="width: 100%; padding: 10px; border: 2px solid #333; border-radius: 8px; font-family: inherit; font-size: 14px;" placeholder="Type words here...">Hello World
Creative Coding</textarea>
        </div>
        <div>
          <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #8B5CF6;">Right Text Block:</label>
          <textarea id="basilText2" rows="4" style="width: 100%; padding: 10px; border: 2px solid #333; border-radius: 8px; font-family: inherit; font-size: 14px;" placeholder="Type words here...">Graph Networks
Visual Design</textarea>
        </div>
      </div>

      <div style="border: 3px solid #333; border-radius: 8px; overflow: hidden; margin-bottom: 20px; background: #F8FAFC;">
        <div id="p5-demo-container"></div>
      </div>

      <div style="display: flex; gap: 10px; margin-bottom: 15px;">
        <button onclick="updateBasilDemo()" style="flex: 1; padding: 12px; background: #6366F1; color: white; border: 2px solid #333; border-radius: 8px; cursor: pointer; font-weight: bold;">
          üîÑ Update Graph
        </button>
        <button onclick="toggleBasilAnimation()" id="animToggleBtn" style="flex: 1; padding: 12px; background: #8B5CF6; color: white; border: 2px solid #333; border-radius: 8px; cursor: pointer; font-weight: bold;">
          ‚è∏Ô∏è Pause Animation
        </button>
        <button onclick="saveP5Canvas()" style="flex: 1; padding: 12px; background: #F59E0B; color: white; border: 2px solid #333; border-radius: 8px; cursor: pointer; font-weight: bold;">
          üíæ Save Image
        </button>
      </div>

      <p style="font-size: 13px; color: #666;">
        <strong>Based on:</strong> <a href="https://basiljs.ch/gallery/" target="_blank" style="color: #6366F1; text-decoration: underline;">basil.js</a> tutorial "01_connecting_all_words_with_lines" -
        Every word from the left block connects to every word on the right, creating <code>M √ó N</code> connections. Try editing the text to see the network update in real-time!
      </p>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
</body>
</html>
